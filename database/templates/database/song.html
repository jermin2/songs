{% extends "database/layout.html" %}

{% block body %}

<style>

</style>

<div class="container">

    {% if user.is_authenticated %}
    <a href="{% url 'edit' id=song.id %}" class="btn btn-outline-primary">Edit</a>
    <a href="{% url 'edit' id=song.id %}" class="btn btn-outline-secondary">Delete</a>
        {% if favourite %}
        <a href="#" id="favourite-btn" class="btn btn-outline-secondary"  style="display:none">ü§ç</a>
        <a href="#" id="unfavourite-btn" class="btn btn-outline-secondary" >‚ù§Ô∏è</a>
        {% else %}
        <a href="#" id="favourite-btn" class="btn btn-outline-secondary">ü§ç</a>
        <a href="#" id="unfavourite-btn" class="btn btn-outline-secondary"  style="display:none">‚ù§Ô∏è</a>
        {% endif %}
    {% endif %}

    <div class="title" id="title">{{ song.title }}</div>
    <div class="content" id="content">{{ song.content }}</div>
    <div>
        <div id="author">{{song.author}}</div>
        <div id="composer">{{song.composer}}</div>
        <div id="meter">{{song.meter}}</div>
        <div id="key">{{song.key}}</div>
        <div id="year">{{song.year}}</div>
    </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelector('#favourite-btn').addEventListener('click', () => {
            favourite("favourite")
        })
        document.querySelector('#unfavourite-btn').addEventListener('click', () => {
            favourite("unfavourite")
        })
    })

    function favourite(method) {
        console.log("favourite this song")
        fetch('/favourite', {
            method: 'POST',
            body: JSON.stringify({
                song_id: {{song.id}},
                method: method
            })
        })
        .then(response => response.json())
        .then(result => {
            console.log(result)
            // Get the status (whether it is favourited or not)
            if (result.favourite === true){
                document.querySelector("#favourite-btn").style.display = "none"
                document.querySelector("#unfavourite-btn").style.display = "inline-block"
            } else {
                document.querySelector("#unfavourite-btn").style.display = "none"
                document.querySelector("#favourite-btn").style.display = "inline-block"
            }

        })

    }
</script>
{% endblock %}